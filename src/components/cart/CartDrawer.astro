---
---

<div
  id="cart-drawer"
  class="hs-overlay fixed end-0 top-0 z-[60] hidden h-full w-full max-w-md translate-x-full transform border-s bg-white transition-all duration-300 hs-overlay-open:translate-x-0 dark:border-neutral-700 dark:bg-neutral-800"
  tabindex="-1"
>
  <div class="flex h-full flex-col">
    <div class="flex items-center justify-between border-b px-4 py-3 dark:border-neutral-700">
      <h3 class="font-bold text-gray-800 dark:text-white">Shopping Cart</h3>
      <button
        type="button"
        class="flex h-7 w-7 items-center justify-center rounded-full border border-transparent text-sm font-semibold text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none dark:text-white dark:hover:bg-neutral-700 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
        data-hs-overlay="#cart-drawer"
      >
        <span class="sr-only">Close modal</span>
        <svg
          class="h-4 w-4"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M18 6 6 18"></path>
          <path d="m6 6 12 12"></path>
        </svg>
      </button>
    </div>

    <div class="h-full overflow-y-auto p-4">
      <div id="cart-items" class="space-y-4">
        <!-- Cart items will be injected here -->
        <p class="text-center text-gray-500 dark:text-gray-400">Your cart is empty.</p>
      </div>
    </div>

    <div class="border-t p-4 dark:border-neutral-700">
      <div class="mb-4 flex justify-between text-lg font-bold text-gray-800 dark:text-white">
        <span>Total</span>
        <span id="cart-total">$0.00</span>
      </div>
      <a
        href="/checkout"
        class="inline-flex w-full items-center justify-center gap-x-2 rounded-lg border border-transparent bg-orange-500 px-4 py-3 text-sm font-semibold text-white hover:bg-orange-600 disabled:opacity-50 disabled:pointer-events-none dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-gray-600"
      >
        Checkout
      </a>
    </div>
  </div>
</div>

<script>
  import { $cart, removeFromCart } from "@stores/cartStore";

  const cartItemsContainer = document.getElementById("cart-items");
  const cartTotalElement = document.getElementById("cart-total");

  $cart.subscribe((cart) => {
    if (!cartItemsContainer || !cartTotalElement) return;

    const items = Object.values(cart);
    
    if (items.length === 0) {
      cartItemsContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Your cart is empty.</p>';
      cartTotalElement.textContent = "$0.00";
      return;
    }

    let total = 0;
    cartItemsContainer.innerHTML = items.map((item) => {
      total += item.price * item.quantity;
      return `
        <div class="flex gap-x-4 rounded-lg border p-3 dark:border-neutral-700">
          <div class="flex-1">
            <h4 class="text-sm font-medium text-gray-800 dark:text-white">${item.title}</h4>
            <p class="text-xs text-gray-500 dark:text-gray-400">Qty: ${item.quantity}</p>
            <p class="text-sm font-semibold text-gray-800 dark:text-white">$${(item.price * item.quantity).toFixed(2)}</p>
          </div>
          <button 
            data-id="${item.id}" 
            class="remove-btn text-sm text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400"
          >
            Remove
          </button>
        </div>
      `;
    }).join("");

    cartTotalElement.textContent = `$${total.toFixed(2)}`;

    // Add event listeners to remove buttons
    document.querySelectorAll(".remove-btn").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const id = (e.target as HTMLElement).dataset.id;
        if (id) removeFromCart(id);
      });
    });
  });
</script>
